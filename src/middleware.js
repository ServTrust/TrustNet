import { NextResponse } from 'next/server'\n\nconst rateLimit = new Map()\nconst LIMIT = parseInt(process.env.RATE_LIMIT_PER_DAY || '20', 10)\nconst WINDOW = 24 * 60 * 60 * 1000\n\nexport function middleware(request) {\n  const ip = request.ip ?? request.headers.get('x-forwarded-for') ?? 'unknown'\n  const now = Date.now()\n\n  const userRequests = rateLimit.get(ip) || []\n  const recentRequests = userRequests.filter(time => now - time < WINDOW)\n\n  if (recentRequests.length >= LIMIT) {\n    return new NextResponse('Rate limit exceeded. Try again tomorrow.', { status: 429 })\n  }\n\n  recentRequests.push(now)\n  rateLimit.set(ip, recentRequests)\n\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: '/api/:path*',\n}
